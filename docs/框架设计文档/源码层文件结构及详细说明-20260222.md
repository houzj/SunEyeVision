1.分层结构目录
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              分层架构目录结构                                         │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   src/                                                                              │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  Layer 0: SDK层 (零依赖)                                                │  │
│   │   │  ─────────────────────────────────────────────────────────────────────  │  │
│   │   │                                                                         │  │
│   │   │  Plugin.Abstractions/                                                   │  │
│   │   │  ├── Core/                    核心契约                                  │  │
│   │   │  ├── ViewModels/              ViewModel基类                             │  │
│   │   │  └── *.cs                     接口/元数据定义                           │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                      ↓                                          │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  Layer 1: 领域层 (核心业务)                                              │  │
│   │   │  ─────────────────────────────────────────────────────────────────────  │  │
│   │   │                                                                         │  │
│   │   │  Core/                                                                   │  │
│   │   │  ├── Interfaces/             接口定义                                  │  │
│   │   │  ├── Services/              服务实现                                   │  │
│   │   │  ├── IO/                    文件访问管理                               │  │
│   │   │  ├── Models/                数据模型                                   │  │
│   │   │  ├── Enums/                 枚举定义                                   │  │
│   │   │  └── Events/                事件定义                                   │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                      ↓                                          │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  Layer 2: 基础设施层 (技术支持)                                          │  │
│   │   │  ─────────────────────────────────────────────────────────────────────  │  │
│   │   │                                                                         │  │
│   │   │  Plugin.Infrastructure/       插件管理基础设施                          │  │
│   │   │  ├── Infrastructure/         基础设施接口                              │  │
│   │   │  └── Managers/               管理器实现                                │  │
│   │   │                                                                         │  │
│   │   │  DeviceDriver/               设备驱动                                  │  │
│   │   │  ├── BaseDeviceDriver.cs     驱动基类                                  │  │
│   │   │  ├── DeviceManager.cs        设备管理器                                │  │
│   │   │  └── SimulatedCameraDriver.cs 模拟相机                                 │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                      ↓                                          │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  Layer 3: 应用层 (工作流引擎)                                            │  │
│   │   │  ─────────────────────────────────────────────────────────────────────  │  │
│   │   │                                                                         │  │
│   │   │  Workflow/                                                              │  │
│   │   │  ├── Workflow*.cs            核心引擎                                  │  │
│   │   │  ├── *Node.cs                节点系统                                  │  │
│   │   │  ├── *Plugin.cs              插件支持                                  │  │
│   │   │  ├── Event*.cs               事件驱动                                  │  │
│   │   │  └── Execution*.cs           执行结果                                  │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                      ↓                                          │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  Layer 4: 表现层 (WPF用户界面)                                           │  │
│   │   │  ─────────────────────────────────────────────────────────────────────  │  │
│   │   │                                                                         │  │
│   │   │  UI/                                                                     │  │
│   │   │  ├── ViewModels/            MVVM视图模型                               │  │
│   │   │  ├── Views/                 视图和控件                                 │  │
│   │   │  ├── Controls/              自定义控件                                 │  │
│   │   │  ├── Services/              UI服务                                    │  │
│   │   │  ├── Converters/            值转换器                                  │  │
│   │   │  ├── Commands/              命令实现                                  │  │
│   │   │  ├── Factories/             工厂类                                    │  │
│   │   │  ├── Adapters/              适配器                                    │  │
│   │   │  ├── Models/                UI模型                                    │  │
│   │   │  └── App.xaml               应用入口                                  │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────────┘
2.各层详细文件结构及说明
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                     Layer 0: Plugin.Abstractions 详细结构                            │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   Plugin.Abstractions/                    📦 SDK层 - 零依赖纯契约                    │
│   │                                                                                 │
│   ├── Core/                               核心契约定义                              │
│   │   ├── IImageProcessor.cs                   图像处理器核心接口                   │
│   │   │                                         └── ProcessAsync()                 │
│   │   │                                         └── Name, Description              │
│   │   │                                                                             │
│   │   ├── AlgorithmParameters.cs               算法参数基类                        │
│   │   │                                         └── 可序列化参数容器               │
│   │   │                                                                             │
│   │   └── AlgorithmResult.cs                   算法结果基类                        │
│   │                                              └── Success, OutputImage, Errors   │
│   │                                                                                 │
│   ├── ViewModels/                         工具ViewModel基类                         │
│   │   └── ToolDebugViewModelBase.cs            调试窗口ViewModel基类               │
│   │                                              └── Execute(), InputImage, Output │
│   │                                                                                 │
│   ├── IToolPlugin.cs                      工具插件接口                              │
│   │                                        └── Metadata, CreateViewModel/View/...   │
│   │                                                                                 │
│   ├── ToolMetadata.cs                     工具元数据                                │
│   │                                        └── Name, Category, Description, Icon   │
│   │                                                                                 │
│   ├── ParameterMetadata.cs                参数元数据                                │
│   │                                        └── Name, Type, DefaultValue, Range     │
│   │                                                                                 │
│   ├── ValidationResult.cs                 验证结果                                  │
│   │                                        └── IsValid, Errors                     │
│   │                                                                                 │
│   └── SunEyeVision.Plugin.Abstractions.csproj                                      │
│       ├── <TargetFramework>net9.0</TargetFramework>                                │
│       ├── <PackageId>SunEyeVision.Plugin.SDK</PackageId>                           │
│       └── 无任何项目引用和NuGet依赖                                                 │
│                                                                                     │
│   ✅ 特点: 零依赖 | 纯契约 | 可独立打包分发                                         │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                          Layer 1: Core 详细结构                                      │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   Core/                                   🌐 领域层 - 核心业务逻辑                    │
│   │                                                                                 │
│   ├── Interfaces/                         接口定义                                  │
│   │   ├── Plugins/                        插件相关接口                              │
│   │   │   └── ...                                                                  │
│   │   ├── ILogger.cs                        日志接口                                │
│   │   │                                     └── Log(level, message)                │
│   │   ├── IConfigManager.cs                 配置管理接口                            │
│   │   │                                     └── Load/Save/Get/Set                  │
│   │   └── IDeviceManager.cs                 设备管理接口                            │
│   │                                          └── Connect/Disconnect/GetDevices     │
│   │                                                                                 │
│   ├── Services/                           服务实现                                  │
│   │   │                                                                             │
│   │   │   日志系统                                                                 │
│   │   ├── ConsoleLogger.cs                  控制台日志输出                          │
│   │   ├── FileLogger.cs                     文件日志输出                            │
│   │   ├── OptimizedLogger.cs                优化日志(异步/批量)                     │
│   │   └── LogManager.cs                     日志管理器                              │
│   │                                                                                 │
│   │   │   配置管理                                                                 │
│   │   └── JsonConfigManager.cs              JSON配置管理器                          │
│   │                                                                                 │
│   │   │   插件管理                                                                 │
│   │   └── PluginManager.cs                  插件管理器                              │
│   │                                                                                 │
│   ├── IO/                                 文件I/O管理                               │
│   │   ├── IFileAccessManager.cs             文件访问管理器接口                      │
│   │   │                                     └── Acquire/Release/TrackReferences    │
│   │   ├── FileAccessManager.cs              文件访问管理器实现                      │
│   │   │                                     └── 引用计数 + 延迟删除                │
│   │   ├── FileAccessScope.cs                RAII文件访问作用域                      │
│   │   │                                     └── using var scope = manager.Acquire() │
│   │   └── FileAccessServiceRegistration.cs  DI注册扩展                              │
│   │                                          └── AddFileAccessManager()            │
│   │                                                                                 │
│   ├── Models/                             数据模型                                  │
│   │   ├── DeviceInfo.cs                     设备信息模型                            │
│   │   ├── Mat.cs                            OpenCV Mat包装                          │
│   │   └── NodeType.cs                       节点类型枚举                            │
│   │                                                                                 │
│   ├── Enums/                              枚举定义                                  │
│   │   └── LogLevel.cs                       日志级别                                │
│   │                                          └── Debug/Info/Warning/Error/Fatal    │
│   │                                                                                 │
│   ├── Events/                             事件定义                                  │
│   │   └── ...                                                                      │
│   │                                                                                 │
│   └── SunEyeVision.Core.csproj                                                      │
│       ├── <TargetFramework>net9.0</TargetFramework>                                │
│       ├── 项目引用: Plugin.Abstractions                                            │
│       └── NuGet: OpenCvSharp4, MS.DI.Abstractions, System.Text.Json                │
│                                                                                     │
│   ✅ 特点: 依赖反转实现 | 文件生命周期管理 | 可扩展日志系统                          │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                      Layer 2: Plugin.Infrastructure 详细结构                         │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   Plugin.Infrastructure/                  ⚙️ 基础设施层 - 插件管理                    │
│   │                                                                                 │
│   ├── Infrastructure/                     基础设施接口                              │
│   │   └── IPluginManager.cs                插件管理器接口                          │
│   │                                          └── Load/Unload/Register/Get         │
│   │                                                                                 │
│   ├── Managers/                           管理器实现                                │
│   │   │                                                                             │
│   │   ├── Plugin/                          插件管理                                │
│   │   │   ├── PluginLoader.cs               插件加载器                              │
│   │   │   │                                  └── LoadFromDirectory/Assembly        │
│   │   │   └── PluginManager.cs              插件管理器                              │
│   │   │                                      └── 注册/注销/获取插件                 │
│   │   │                                                                             │
│   │   └── Tool/                            工具管理                                │
│   │       └── ToolRegistry.cs              工具注册表                              │
│   │                                          └── 工具注册和查找                    │
│   │                                                                                 │
│   └── SunEyeVision.Plugin.Infrastructure.csproj                                    │
│       ├── <TargetFramework>net9.0-windows</TargetFramework>                        │
│       ├── 项目引用: Core, Plugin.Abstractions                                      │
│       └── NuGet: OpenCvSharp4                                                      │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                        Layer 2: DeviceDriver 详细结构                                │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   DeviceDriver/                           🔌 基础设施层 - 设备驱动                    │
│   │                                                                                 │
│   ├── BaseDeviceDriver.cs                设备驱动基类                               │
│   │                                        └── Connect/Disconnect/Read             │
│   │                                                                                 │
│   ├── DeviceManager.cs                   设备管理器                                 │
│   │                                        └── 管理所有设备驱动                     │
│   │                                                                                 │
│   ├── SimulatedCameraDriver.cs           模拟相机驱动                               │
│   │                                        └── 测试用模拟设备                       │
│   │                                                                                 │
│   └── SunEyeVision.DeviceDriver.csproj                                             │
│       ├── <TargetFramework>net9.0</TargetFramework>                                │
│       ├── 项目引用: Core                                                           │
│       └── NuGet: OpenCvSharp4                                                      │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                        Layer 3: Workflow 详细结构                                    │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   Workflow/                               📋 应用层 - 工作流引擎                      │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  核心引擎 (6个文件)                                                      │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │                                                                         │  │
│   │   │  Workflow.cs                        工作流模型                          │  │
│   │   │                                      └── Nodes, Connections             │  │
│   │   │                                                                         │  │
│   │   │  WorkflowEngine.cs                  工作流引擎                          │  │
│   │   │                                      └── Load/Validate/ExecuteSync     │  │
│   │   │                                                                         │  │
│   │   │  WorkflowExecutionEngine.cs        执行引擎 (异步控制)                   │  │
│   │   │                                      └── ExecuteAsync/Pause/Resume/Stop │  │
│   │   │                                                                         │  │
│   │   │  WorkflowEngineFactory.cs          引擎工厂                            │  │
│   │   │                                      └── CreateEngine()                │  │
│   │   │                                                                         │  │
│   │   │  WorkflowContext.cs                执行上下文                           │  │
│   │   │                                      └── Variables/CallStack/NodeStates │  │
│   │   │                                                                         │  │
│   │   │  ExecutionResult.cs                执行结果                             │  │
│   │   │                                      └── Success/Outputs/Errors/Stats   │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  节点系统 (6个文件)                                                      │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │                                                                         │  │
│   │   │  WorkflowNode.cs                    节点基类                            │  │
│   │   │                                      └── InputPorts/OutputPorts/Execute │  │
│   │   │                                                                         │  │
│   │   │  AlgorithmNode.cs                  算法节点                            │  │
│   │   │                                      └── 调用 IImageProcessor           │  │
│   │   │                                                                         │  │
│   │   │  WorkflowControlNode.cs            控制节点基类                         │  │
│   │   │                                      └── 流程控制抽象                   │  │
│   │   │                                                                         │  │
│   │   │  SubroutineNode.cs                 子程序节点                          │  │
│   │   │                                      └── 循环/参数映射                  │  │
│   │   │                                                                         │  │
│   │   │  ConditionNode.cs                  条件判断节点                         │  │
│   │   │                                      └── 分支判断                       │  │
│   │   │                                                                         │  │
│   │   │  WorkflowNodeFactory.cs            节点工厂                            │  │
│   │   │                                      └── CreateNode()                  │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  插件支持 (3个文件)                                                      │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │                                                                         │  │
│   │   │  IWorkflowControlPlugin.cs          工作流控制插件接口                   │  │
│   │   │  SubroutinePlugin.cs                子程序插件实现                       │  │
│   │   │  NodeInterfaceFactory.cs            节点接口工厂                         │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  事件驱动 (5个文件)                                                      │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │                                                                         │  │
│   │   │  EventDrivenExecutor.cs             事件驱动执行器                       │  │
│   │   │  EventBusIntegration.cs             事件总线集成                         │  │
│   │   │  VisionEvents.cs                    视觉事件定义                         │  │
│   │   │  TriggerManager.cs                  触发器管理                           │  │
│   │   │  ImageQueue.cs                      图像队列                             │  │
│   │   │                                                                         │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   └── SunEyeVision.Workflow.csproj                                                  │
│       ├── <TargetFramework>net9.0-windows</TargetFramework>                        │
│       ├── 项目引用: Core, Plugin.Infrastructure, Plugin.Abstractions               │
│       └── NuGet: OpenCvSharp                                                       │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           Layer 4: UI 详细结构                                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   UI/                                     🖥️ 表现层 - WPF用户界面                     │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  应用入口 (3个文件)                                                      │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │  App.xaml                           应用程序定义                         │  │
│   │   │  App.xaml.cs                        应用程序入口                         │  │
│   │   │  AssemblyInfo.cs                    程序集信息                           │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  ViewModels (9个文件) MVVM视图模型                                       │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │  ViewModelBase.cs                   ViewModel基类                        │  │
│   │   │  MainWindowViewModel.cs             主窗口                              │  │
│   │   │  ToolboxViewModel.cs                工具箱                              │  │
│   │   │  WorkflowViewModel.cs               工作流                              │  │
│   │   │  WorkflowTabViewModel.cs            工作流标签                          │  │
│   │   │  WorkflowTabControlViewModel.cs     标签控件                            │  │
│   │   │  PropertyPanelViewModel.cs          属性面板                            │  │
│   │   │  DevicePanelViewModel.cs            设备面板                            │  │
│   │   │  RelayCommand.cs                    命令实现                            │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  Views/ 视图目录                                                         │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │  Controls/                          控件视图 (22个文件)                   │  │
│   │   │  ├── DiagramCanvas.xaml             画布控件                             │  │
│   │   │  ├── ToolboxControl.xaml            工具箱控件                           │  │
│   │   │  ├── PropertyPanel.xaml             属性面板                             │  │
│   │   │  ├── NodePropertyEditor.xaml        节点属性编辑器                       │  │
│   │   │  ├── ImagePreviewControl.xaml       图像预览控件                         │  │
│   │   │  └── ... 更多控件                                                    │  │
│   │   │                                                                         │  │
│   │   │  Windows/                          窗口视图 (9个文件)                     │  │
│   │   │  ├── MainWindow.xaml               主窗口                               │  │
│   │   │  ├── ToolDebugWindow.xaml          工具调试窗口                          │  │
│   │   │  └── ... 更多窗口                                                    │  │
│   │   │                                                                         │  │
│   │   │  Resources/                        资源文件                               │  │
│   │   │  └── Styles.xaml                   样式定义                             │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  Controls/ 自定义控件                                                    │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │  Rendering/                         GPU渲染控件                          │  │
│   │   │  ├── DirectXThumbnailRenderer.cs    DirectX缩略图渲染                    │  │
│   │   │  ├── DirectXGpuThumbnailLoader.cs   GPU缩略图加载                        │  │
│   │   │  ├── ExifThumbnailExtractor.cs      EXIF缩略图提取                       │  │
│   │   │  └── GpuPerformanceTest.cs          GPU性能测试                          │  │
│   │   │                                                                         │  │
│   │   │  Helpers/                          辅助控件                               │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  Services/ UI服务 (62个文件)                                             │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │  图像处理、缩略图、缓存、工作流等各类服务                                │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐  │
│   │   │  其他支持目录                                                            │  │
│   │   ├─────────────────────────────────────────────────────────────────────────┤  │
│   │   │  Core/Services/                     UI核心服务                           │  │
│   │   │  ├── PluginUIAdapter.cs             插件UI适配器                         │  │
│   │   │                                                                         │  │
│   │   │  Converters/                        值转换器 (27个)                       │  │
│   │   │                                                                         │  │
│   │   │  Commands/                          命令实现                              │  │
│   │   │                                                                         │  │
│   │   │  Events/                            UI事件定义                            │  │
│   │   │                                                                         │  │
│   │   │  Extensions/                        扩展方法                              │  │
│   │   │  └── WorkflowNodeExtensions.cs      工作流节点扩展                        │  │
│   │   │                                                                         │  │
│   │   │  Factories/                         工厂类                               │  │
│   │   │  └── ToolDebugWindowFactory.cs      工具调试窗口工厂                      │  │
│   │   │                                                                         │  │
│   │   │  Adapters/                          适配器 (12个)                         │  │
│   │   │                                                                         │  │
│   │   │  Models/                            UI数据模型 (9个)                       │  │
│   │   │                                                                         │  │
│   │   │  Shared/                            共享组件                              │  │
│   │   │                                                                         │  │
│   │   │  Diagnostics/                       诊断工具                              │  │
│   │   │                                                                         │  │
│   │   │  Infrastructure/                    UI基础设施                            │  │
│   │   └─────────────────────────────────────────────────────────────────────────┘  │
│   │                                                                                 │
│   └── SunEyeVision.UI.csproj                                                       │
│       ├── <OutputType>WinExe</OutputType>                                          │
│       ├── <TargetFramework>net9.0-windows</TargetFramework>                        │
│       ├── 项目引用: Core, Workflow, DeviceDriver, Plugin.*                         │
│       └── NuGet: AIStudio.Wpf.DiagramDesigner, OpenCvSharp4, SharpDX, MSAGL等      │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
