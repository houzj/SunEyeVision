<UserControl x:Class="SunEyeVision.Plugin.SDK.UI.Controls.ROI.ROIImageEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:SunEyeVision.Plugin.SDK.UI.Controls.ROI"
             Loaded="OnLoaded">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 工具栏 -->
        <ToolBar Grid.Row="0" Padding="4,2" Background="#F5F5F5">
            <ToolBar.Resources>
                <Style TargetType="ToggleButton">
                    <Setter Property="Padding" Value="8,4"/>
                    <Setter Property="Margin" Value="2,0"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderBrush" Value="#D0D0D0"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Cursor" Value="Hand"/>
                </Style>
                <Style TargetType="Button">
                    <Setter Property="Padding" Value="8,4"/>
                    <Setter Property="Margin" Value="2,0"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderBrush" Value="#D0D0D0"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Cursor" Value="Hand"/>
                </Style>
            </ToolBar.Resources>

            <!-- 模式切换 -->
            <Separator Margin="0,0,8,0"/>
            <ToggleButton x:Name="InheritModeButton"
                          Content="继承"
                          IsChecked="True"
                          Click="InheritModeButton_Click"
                          ToolTip="继承模式 - 只读显示"/>
            <ToggleButton x:Name="EditModeButton"
                          Content="编辑"
                          IsChecked="False"
                          Click="EditModeButton_Click"
                          ToolTip="编辑模式 - 支持创建、编辑、删除"/>

            <Separator Margin="8,0"/>

            <!-- 绘制工具 -->
            <ToggleButton x:Name="SelectToolButton"
                          Content="选择"
                          IsChecked="True"
                          Click="ToolButton_Click"
                          ToolTip="选择工具 (V)"
                          IsEnabled="{Binding IsEditMode}"/>
            <ToggleButton x:Name="MultiSelectToolButton"
                          Content="多选"
                          IsChecked="False"
                          Click="ToolButton_Click"
                          ToolTip="多选工具"
                          IsEnabled="{Binding IsEditMode}"/>

            <Separator Margin="8,0"/>

            <ToggleButton x:Name="RectangleToolButton"
                          Content="矩形"
                          IsChecked="False"
                          Click="ToolButton_Click"
                          ToolTip="矩形工具 (R)"
                          IsEnabled="{Binding IsEditMode}"/>
            <ToggleButton x:Name="CircleToolButton"
                          Content="圆形"
                          IsChecked="False"
                          Click="ToolButton_Click"
                          ToolTip="圆形工具 (C)"
                          IsEnabled="{Binding IsEditMode}"/>
            <ToggleButton x:Name="RotatedRectangleToolButton"
                          Content="旋转矩形"
                          IsChecked="False"
                          Click="ToolButton_Click"
                          ToolTip="旋转矩形工具"
                          IsEnabled="{Binding IsEditMode}"/>
            <ToggleButton x:Name="LineToolButton"
                          Content="直线"
                          IsChecked="False"
                          Click="ToolButton_Click"
                          ToolTip="直线工具 (L)"
                          IsEnabled="{Binding IsEditMode}"/>

            <Separator Margin="8,0"/>

            <!-- 操作按钮 -->
            <Button Content="删除选中"
                    Click="DeleteSelectedButton_Click"
                    ToolTip="删除选中的ROI (Delete)"
                    IsEnabled="{Binding IsEditMode}"/>
            <Button Content="清除所有"
                    Click="ClearAllButton_Click"
                    ToolTip="清除所有ROI"
                    IsEnabled="{Binding IsEditMode}"/>

            <Separator Margin="8,0"/>

            <!-- 撤销/重做 -->
            <Button x:Name="UndoButton"
                    Content="撤销"
                    Click="UndoButton_Click"
                    ToolTip="撤销 (Ctrl+Z)"
                    IsEnabled="False"/>
            <Button x:Name="RedoButton"
                    Content="重做"
                    Click="RedoButton_Click"
                    ToolTip="重做 (Ctrl+Y)"
                    IsEnabled="False"/>

            <Separator Margin="8,0"/>

            <!-- 缩放控制 -->
            <Button Content="适应窗口"
                    Click="FitToWindow_Click"
                    ToolTip="适应窗口大小"/>
            <Button Content="实际大小"
                    Click="ActualSize_Click"
                    ToolTip="显示实际大小 (100%)"/>
            <TextBlock x:Name="ZoomText"
                       Text="100%"
                       VerticalAlignment="Center"
                       Margin="4,0"/>
        </ToolBar>

        <!-- 图像和ROI编辑层 - 使用Canvas实现平移缩放 -->
        <Canvas x:Name="MainCanvas"
                Grid.Row="1"
                Background="#2D2D2D"
                ClipToBounds="True"
                MouseWheel="MainCanvas_MouseWheel"
                MouseLeftButtonDown="MainCanvas_MouseLeftButtonDown"
                MouseMove="MainCanvas_MouseMove"
                MouseLeftButtonUp="MainCanvas_MouseLeftButtonUp"
                SizeChanged="MainCanvas_SizeChanged">

            <!-- 图像容器 - 仅处理ROI相关事件，平移在MainCanvas处理 -->
            <Grid x:Name="ImageContainer"
                  Background="Transparent"
                  MouseLeftButtonDown="ImageContainer_MouseLeftButtonDown"
                  MouseMove="ImageContainer_MouseMove"
                  MouseLeftButtonUp="ImageContainer_MouseLeftButtonUp">
                <Grid.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform x:Name="ImageScaleTransform"/>
                        <TranslateTransform x:Name="ImageTranslateTransform"/>
                    </TransformGroup>
                </Grid.RenderTransform>

                <Image x:Name="ImageControl"
                       Stretch="None"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>

                <!-- ROI编辑层 - Canvas尺寸绑定到图像 -->
                <Canvas x:Name="ROICanvas"
                        IsHitTestVisible="False"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"/>
            </Grid>
        </Canvas>

        <!-- 状态栏 -->
        <StatusBar Grid.Row="2" Background="#F0F0F0" Padding="8,2">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="就绪"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="ROIcountText" Text="ROI数量: 0"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="ModeText" Text="模式: 继承"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="PositionText" Text="位置: (0, 0)"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="ImageSizeText" Text="图像: -"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>
