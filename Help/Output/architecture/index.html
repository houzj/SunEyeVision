<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>软件架构 - SunEyeVision 帮助文档</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>SunEyeVision</h1>
                <p>机器视觉算法平台</p>
            </div>
            <div class="nav-menu">
                <a href="../index.html" class="nav-item">🏠 首页</a>
                <a href="../features/index.html" class="nav-item">✨ 功能特性</a>
                <a href="../usermanual/index.html" class="nav-item">📖 用户手册</a>
                <a href="../architecture/index.html" class="nav-item active">🏗️ 软件架构</a>
                <a href="../roadmap/index.html" class="nav-item">🗺️ 开发路线图</a>
                <a href="../progress/index.html" class="nav-item">📊 开发进度</a>
                <a href="../api/index.html" class="nav-item">🔧 API 文档</a>
            </div>
        </nav>

        <main class="main-content">
            <header class="content-header">
                <h1>软件架构</h1>
                <div class="subtitle">SunEyeVision 系统设计与架构说明</div>
            </header>

            <section class="content-section">
                <h2>总体架构</h2>
                <p>
                    SunEyeVision 采用分层架构设计，参考了 VisionMaster 的架构理念，
                    将系统划分为表现层、业务逻辑层、算法层、设备驱动层和核心层。
                    这种分层设计确保了系统的高内聚低耦合，便于维护和扩展。
                </p>

                <h3>架构层次</h3>
                <pre style="font-size: 12px; line-height: 1.4;">
┌─────────────────────────────────────────────────────────────────┐
│                      用户界面层 (Presentation Layer)          │
│                    SunEyeVision.UI (WPF + MVVM)               │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │   MainWindow │  │   Workflow   │  │   Parameter  │       │
│  │   (主界面)    │  │   Designer   │  │    Panel     │       │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘       │
│         │                 │                  │                 │
│  ┌──────▼─────────────────▼──────────────────▼───────┐       │
│  │         ViewModels (MVVM)                          │       │
│  │  MainWindowViewModel, WorkflowViewModel, etc.     │       │
│  └────────────────────────┬────────────────────────────┘       │
└─────────────────────────┬──────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                      业务逻辑层 (Business Layer)                │
│                    SunEyeVision.Workflow                        │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  WorkflowEngine (工作流引擎)                           │   │
│  │  - CreateWorkflow()                                    │   │
│  │  - Execute()                                           │   │
│  │  - SaveWorkflowToFile()                                │   │
│  └──────────────────┬──────────────────────────────────────┘   │
│                     │                                          │
│  ┌──────────────────▼──────────────────────────────────────┐   │
│  │  Workflow (工作流)                                     │   │
│  │  - AddNode()                                          │   │
│  │  - ConnectNodes()                                     │   │
│  │  - Execute()                                          │   │
│  └──────────────────┬──────────────────────────────────────┘   │
│                     │                                          │
│  ┌──────────────────▼──────────────────────────────────────┐   │
│  │  AlgorithmNode (算法节点)                               │   │
│  │  - Parameters                                         │   │
│  │  - ExecuteAlgorithm()                                 │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────┬──────────────────────────────────────┘
                          │
         ┌────────────────┼────────────────┐
         │                │                │
         ▼                ▼                ▼
┌────────────────┐ ┌────────────────┐ ┌────────────────┐
│  算法层       │ │  设备驱动层   │ │  插件系统层   │
├────────────────┤ ├────────────────┤ ├────────────────┤
│ SunEyeVision  │ │ SunEyeVision  │ │ SunEyeVision  │
│  .Algorithms  │ │ .DeviceDriver │ │ .PluginSystem │
└────────────────┘ └────────┬───────┘ └────────┬───────┘
                           │                 │
                           └────────┬────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                      核心层 (Core Layer)                      │
│                    SunEyeVision.Core                          │
└─────────────────────────────────────────────────────────────────┘
                </pre>
            </section>

            <section class="content-section">
                <h2>模块依赖关系</h2>
                <p>各模块之间的依赖关系如下：</p>
                <pre style="font-size: 12px; line-height: 1.4;">
                    SunEyeVision.UI
                           │
           ┌───────────────┼───────────────┐
           │               │               │
           ▼               ▼               ▼
    SunEyeVision    SunEyeVision    SunEyeVision
    .Workflow       .Algorithms     .PluginSystem
           │               │               │
           └───────────────┼───────────────┘
                           │
                           ▼
    SunEyeVision.DeviceDriver
           │
           ▼
    SunEyeVision.Core
           │
           ▼
    .NET Framework / Runtime
                </pre>
                <p><strong>依赖说明：</strong></p>
                <ul>
                    <li><strong>UI 层</strong>：依赖于 Workflow、Algorithms 和 PluginSystem</li>
                    <li><strong>Workflow 层</strong>：依赖于 Core 和 Algorithms</li>
                    <li><strong>Algorithms 层</strong>：依赖于 Core</li>
                    <li><strong>DeviceDriver 层</strong>：依赖于 Core</li>
                    <li><strong>PluginSystem 层</strong>：依赖于 Core</li>
                    <li><strong>Core 层</strong>：独立的基础层，不依赖其他业务模块</li>
                </ul>
            </section>

            <section class="content-section">
                <h2>核心模块详解</h2>

                <h3>1. SunEyeVision.Core</h3>
                <p>核心基础库，提供整个系统的基础功能和接口定义。</p>
                <h4>主要组件：</h4>
                <ul>
                    <li><strong>Services</strong>：日志服务、配置管理服务、事件总线</li>
                    <li><strong>Interfaces</strong>：ILogger, IConfigManager, IDeviceManager, IImageProcessor</li>
                    <li><strong>Models</strong>：DeviceInfo, AlgorithmParameters, AlgorithmResult, Mat</li>
                </ul>

                <h3>2. SunEyeVision.Algorithms</h3>
                <p>视觉算法库，提供各种图像处理和机器视觉算法。</p>
                <h4>算法分类：</h4>
                <ul>
                    <li><strong>预处理算法</strong>：高斯模糊、中值滤波、二值化、灰度转换</li>
                    <li><strong>特征提取</strong>：边缘检测、角点检测、斑点分析、直线/圆检测</li>
                    <li><strong>测量算法</strong>：距离测量、角度测量、面积测量、周长测量</li>
                    <li><strong>识别算法</strong>：OCR、条形码、二维码、模板匹配</li>
                </ul>

                <h3>3. SunEyeVision.Workflow</h3>
                <p>工作流引擎，支持可视化的工作流设计和管理。</p>
                <h4>核心功能：</h4>
                <ul>
                    <li><strong>WorkflowEngine</strong>：工作流引擎，负责工作流的创建、加载、执行</li>
                    <li><strong>Workflow</strong>：工作流定义，管理节点和连接关系</li>
                    <li><strong>WorkflowNode</strong>：工作流节点，支持条件分支和循环</li>
                    <li><strong>WorkflowConnection</strong>：工作流连接，管理节点间的数据流</li>
                    <li><strong>WorkflowNodeFactory</strong>：节点工厂，动态创建不同类型的节点</li>
                </ul>
                <h4>高级特性（规划中）：</h4>
                <ul>
                    <li><strong>LoopNode</strong>：循环节点，支持固定次数循环和条件循环</li>
                    <li><strong>SwitchNode</strong>：分支节点，支持条件分支和多路选择</li>
                    <li><strong>ParallelBranchNode</strong>：并行分支节点，支持并行执行和结果汇聚</li>
                    <li><strong>SubWorkflowNode</strong>：子工作流节点，支持工作流嵌套调用</li>
                    <li><strong>TryCatchNode</strong>：异常处理节点，支持 Try-Catch-Finally 结构</li>
                </ul>

                <h3>4. SunEyeVision.DeviceDriver</h3>
                <p>设备驱动模块，支持各种硬件设备的接入和控制。</p>
                <h4>支持的设备类型：</h4>
                <ul>
                    <li><strong>工业相机</strong>：海康威视、Basler、大华、华睿</li>
                    <li><strong>USB 相机</strong>：通用 USB 相机驱动</li>
                    <li><strong>I/O 设备</strong>：数字输入/输出板卡</li>
                    <li><strong>通信模块</strong>：串口、网口、Modbus</li>
                    <li><strong>光源控制</strong>：光源亮度调节、频闪控制</li>
                </ul>

                <h3>5. SunEyeVision.PluginSystem</h3>
                <p>插件系统，支持动态加载和扩展功能。</p>
                <h4>核心功能：</h4>
                <ul>
                    <li><strong>PluginLoader</strong>：插件加载器，从目录加载 DLL 插件</li>
                    <li><strong>IVisionPlugin</strong>：插件接口，定义插件规范</li>
                    <li><strong>PluginContext</strong>：插件上下文，提供插件运行环境</li>
                    <li><strong>PluginMeta</strong>：插件元数据，描述插件信息</li>
                </ul>

                <h3>6. SunEyeVision.UI</h3>
                <p>用户界面，基于 WPF + MVVM 架构。</p>
                <h4>主要窗口：</h4>
                <ul>
                    <li><strong>MainWindow</strong>：主窗口，包含菜单、工具栏、工作区</li>
                    <li><strong>WorkflowCanvasControl</strong>：工作流画布控件，可视化编辑工作流</li>
                    <li><strong>ParameterPanel</strong>：参数面板，编辑算法参数</li>
                    <li><strong>ImageDisplay</strong>：图像显示，实时显示图像和结果</li>
                </ul>
                <h4>UI 控件和服务：</h4>
                <ul>
                    <li><strong>WorkflowTabViewModel</strong>：工作流标签页视图模型</li>
                    <li><strong>WorkflowNodeFactory</strong>：工作流节点工厂</li>
                    <li><strong>NodeSequenceManager</strong>：节点序列管理器</li>
                    <li><strong>WorkflowDragDropHandler</strong>：拖放操作处理器</li>
                    <li><strong>WorkflowPortInteractionHandler</strong>：端口交互处理器</li>
                    <li><strong>WorkflowPathCalculator</strong>：路径计算器</li>
                    <li><strong>WorkflowConnectionManager</strong>：连接管理器</li>
                    <li><strong>SelectionBox</strong>：选择框控件</li>
                </ul>
                <h4>高级功能（规划中）：</h4>
                <ul>
                    <li><strong>智能路径规划</strong>：A* 算法实现最优路径计算</li>
                    <li><strong>智能避障</strong>：自动检测和避开节点障碍</li>
                    <li><strong>多种连线样式</strong>：支持直线、折线、贝塞尔曲线、正交线</li>
                    <li><strong>脚本编辑器</strong>：集成 Monaco Editor，支持代码编辑和调试</li>
                    <li><strong>定制化界面</strong>：支持 Logo、主题、布局等定制</li>
                </ul>
            </section>

            <section class="content-section">
                <h2>新增功能模块</h2>

                <h3>5个核心功能模块规划</h3>
                <p>基于现有架构，SunEyeVision 规划了5个核心功能模块：</p>

                <div class="module-list">
                    <div class="module-item">
                        <h4>1. 工作流流程控制</h4>
                        <ul>
                            <li>循环节点：固定次数、条件、集合迭代</li>
                            <li>分支节点：条件分支、多路选择</li>
                            <li>并行分支：并行执行、结果汇聚</li>
                            <li>子工作流：嵌套调用、参数传递</li>
                            <li>异常处理：Try-Catch-Finally 结构</li>
                        </ul>
                    </div>

                    <div class="module-item">
                        <h4>2. 智能节点连线</h4>
                        <ul>
                            <li>A* 路径规划算法</li>
                            <li>智能避障：碰撞检测、绕行点生成</li>
                            <li>多种连线样式：直线、折线、曲线、正交线</li>
                            <li>路径优化：缓存、动态更新、批量更新</li>
                        </ul>
                    </div>

                    <div class="module-item">
                        <h4>3. 节点执行控制</h4>
                        <ul>
                            <li>执行模式：同步、异步、混合</li>
                            <li>依赖管理：依赖图分析、拓扑排序</li>
                            <li>执行控制：并行度、资源限制、超时、取消</li>
                            <li>执行监控：执行历史、性能统计、资源监控</li>
                        </ul>
                    </div>

                    <div class="module-item">
                        <h4>4. 脚本编辑器</h4>
                        <ul>
                            <li>编辑器特性：语法高亮、智能提示、语法检查</li>
                            <li>调试功能：断点、单步执行、变量监视</li>
                            <li>多语言支持：C#、Python、表达式计算</li>
                            <li>集成功能：工作流集成、算法访问、设备访问</li>
                        </ul>
                    </div>

                    <div class="module-item">
                        <h4>5. 定制化客户界面</h4>
                        <ul>
                            <li>基础定制：Logo、主题配色、标题文本</li>
                            <li>布局定制：面板布局、工具栏、菜单</li>
                            <li>功能定制：权限控制、功能开关、操作流程</li>
                            <li>工作流模板：预设模板、模板锁定、一键加载</li>
                            <li>配置管理：可视化配置、导入导出、多配置</li>
                            <li>用户和角色管理</li>
                        </ul>
                    </div>
                </div>

            <section class="content-section">
                <h2>数据流向</h2>
                <p>系统在执行一次视觉检测时的数据流向：</p>
                <pre style="font-size: 12px; line-height: 1.4;">
┌─────────────────────────────────────────────────────────────┐
│ 用户操作                                                    │
│  (打开工作流、选择算法、设置参数)                           │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│ ViewModels (MVVM)                                          │
│  - 接收用户命令                                            │
│  - 验证参数有效性                                          │
│  - 调用业务逻辑                                            │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│ WorkflowEngine                                             │
│  - 创建工作流                                              │
│  - 添加算法节点                                            │
│  - 建立节点连接                                            │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│ Workflow                                                   │
│  - 管理节点                                                │
│  - 管理连接                                                │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│ DeviceManager                                               │
│  - 打开相机                                                │
│  - 采集图像                                                │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│ Mat (图像数据)                                             │
│  - 图像预处理                                              │
│  - 传递给算法节点                                          │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│ AlgorithmNode 序列执行                                       │
│  Node 1: 高斯模糊 ──► Node 2: 灰度转换                    │
│        │                 │                                 │
│        ▼                 ▼                                 │
│  Node 3: 二值化 ──► Node 4: 边缘检测                    │
│        │                 │                                 │
│        └────────────────┘                                 │
│                           │                                 │
│                           ▼                                 │
└─────────────────────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│ AlgorithmResult (算法结果)                                   │
│  - Success/Status                                          │
│  - ExecutionTime                                            │
│  - OutputImage                                             │
│  - ResultData                                              │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│ Results Display (结果显示)                                  │
│  - 图像显示                                                │
│  - 结果统计                                                │
│  - 报告生成                                                │
└─────────────────────────────────────────────────────────────┘
                </pre>
            </section>

            <section class="content-section">
                <h2>设计模式</h2>
                <p>SunEyeVision 采用了多种设计模式，确保代码的可维护性和可扩展性。</p>

                <h3>MVVM 模式</h3>
                <p>UI 层采用 MVVM (Model-View-ViewModel) 模式，实现视图与逻辑的分离。</p>
                <ul>
                    <li><strong>View</strong>：XAML 界面定义</li>
                    <li><strong>ViewModel</strong>：视图逻辑和状态管理</li>
                    <li><strong>Model</strong>：数据模型</li>
                </ul>

                <h3>策略模式</h3>
                <p>算法采用策略模式，便于动态替换和扩展算法实现。</p>
                <ul>
                    <li><strong>IAlgorithm</strong>：算法接口</li>
                    <li><strong>BaseAlgorithm</strong>：算法基类</li>
                    <li><strong>ConcreteAlgorithm</strong>：具体算法实现</li>
                </ul>

                <h3>工厂模式</h3>
                <p>使用工厂模式创建算法实例和工作流对象。</p>
                <ul>
                    <li><strong>AlgorithmFactory</strong>：算法工厂，根据类型创建算法</li>
                    <li><strong>WorkflowFactory</strong>：工作流工厂，创建工作流实例</li>
                </ul>

                <h3>观察者模式</h3>
                <p>事件总线采用观察者模式，实现模块间的事件通信。</p>
                <ul>
                    <li><strong>IEventBus</strong>：事件总线接口</li>
                    <li><strong>EventBus</strong>：事件总线实现</li>
                </ul>
            </section>

            <section class="content-section">
                <h2>项目历史</h2>
                <p>SunEyeVision 的前身是 VisionMaster 项目。</p>

                <h3>重命名历程</h3>
                <ul>
                    <li><strong>2025-10</strong>：项目启动，命名为 VisionMaster</li>
                    <li><strong>2025-11</strong>：WPF 界面框架搭建完成</li>
                    <li><strong>2025-12</strong>：项目重构和命名规范</li>
                    <li><strong>2026-01</strong>：项目重命名为 SunEyeVision</li>
                </ul>

                <h3>版本历史</h3>
                <ul>
                    <li><strong>V0.1.0</strong>：项目初始化，Core 模块基础功能</li>
                    <li><strong>V0.2.0</strong>：Algorithms 和 Workflow 模块</li>
                    <li><strong>V0.3.0</strong>：WPF 界面框架</li>
                    <li><strong>V0.4.0</strong>：项目重构和命名规范</li>
                    <li><strong>V0.5.0</strong>：重命名为 SunEyeVision</li>
                </ul>
            </section>

            <footer class="footer">
                <p>&copy; 2026 SunEyeVision. 保留所有权利。</p>
            </footer>
        </main>
    </div>

    <script>
        // 导航已通过 a 标签实现，无需额外脚本
    </script>
</body>
</html>
