# Phase 1 手动测试指南

## 构建状态 ✅
```
已成功生成
    322 个警告（均为已存在的警告）
    0 个错误 ⭐
已用时间: 00:00:05.56
```

---

## 测试前准备

### 1. 启动应用程序
```bash
cd d:\MyWork\SunEyeVision\SunEyeVision
dotnet run --project SunEyeVision.UI/SunEyeVision.UI.csproj
```

或者直接运行：
```
run.bat
```

---

## 手动测试清单

### 测试场景 1: 创建节点和连线

**步骤：**
1. ✅ 启动应用程序
2. ✅ 创建 2-3 个节点（从左侧工具箱拖拽）
3. ✅ 尝试从不同端口创建连线
   - 从节点的 **Right** 端口拖拽到另一个节点的 **Left** 端口
   - 从节点的 **Top** 端口拖拽到另一个节点的 **Bottom** 端口
   - 从节点的 **Right** 端口拖拽到另一个节点的 **Top** 端口
   - 从节点的 **Bottom** 端口拖拽到另一个节点的 **Right** 端口

**预期结果：**
- ✅ 连线应该是正交折线（不是贝塞尔曲线）
- ✅ 连线应该有清晰的拐点（3-5段折线）
- ✅ 箭头应该正确指向目标端口
- ✅ 箭头角度应该与最后一段路径一致

---

### 测试场景 2: 节点拖拽测试

**步骤：**
1. ✅ 创建 2 个节点并连接它们
2. ✅ 拖拽其中一个节点
3. ✅ 观察连线路径的实时更新

**预期结果：**
- ✅ 连线路径应该随着节点移动实时更新
- ✅ 路径应该保持正交折线形状
- ✅ 箭头应该始终指向目标端口
- ✅ 拖拽过程应该流畅，无明显卡顿

---

### 测试场景 3: 不同距离的连接

**步骤：**
1. ✅ 创建 2 个节点，相距较近（如 200px）
2. ✅ 连接它们
3. ✅ 将其中一个节点移远（如 500px）
4. ✅ 观察路径变化

**预期结果：**
- ✅ 近距离：应该是简单的三段折线
- ✅ 远距离：可能切换到五段折线策略
- ✅ 路径应该清晰，无重叠或混乱

---

### 测试场景 4: 同向端口连接

**步骤：**
1. ✅ 创建 2 个水平排列的节点
2. ✅ 从第一个节点的 **Right** 端口连接到第二个节点的 **Right** 端口
3. ✅ 从第一个节点的 **Top** 端口连接到第二个节点的 **Top** 端口

**预期结果：**
- ✅ Right->Right：路径应该先向右延伸，然后向下/向上绕行
- ✅ Top->Top：路径应该先向上延伸，然后向右/左绕行
- ✅ 路径应该合理，不会穿过节点

---

### 测试场景 5: 复杂多节点场景

**步骤：**
1. ✅ 创建 5-10 个节点
2. ✅ 在节点之间创建多条连线
3. ✅ 拖拽中间的节点，观察多条连线的更新

**预期结果：**
- ✅ 所有连线都应该正确更新
- ✅ 路径应该清晰，避免重叠
- ✅ 拖拽过程应该流畅

---

### 测试场景 6: 连线删除测试

**步骤：**
1. ✅ 创建 2 个节点并连接
2. ✅ 选中连线（点击连线）
3. ✅ 按 Delete 键删除连线

**预期结果：**
- ✅ 连线应该被删除
- ✅ 节点应该保持不变
- ✅ 无错误或异常

---

### 测试场景 7: 箭头显示测试

**步骤：**
1. ✅ 创建 2 个节点并连接
2. ✅ 仔细观察箭头显示

**预期结果：**
- ✅ 箭头应该在路径终点前约 10px 位置
- ✅ 箭头角度应该与最后一段路径方向一致
- ✅ 水平连线：箭头角度接近 0° 或 180°
- ✅ 垂直连线：箭头角度接近 90° 或 270°

---

## 测试记录模板

请使用以下模板记录测试结果：

| 测试场景 | 测试结果 | 问题/备注 |
|---------|---------|---------|
| 场景1: 创建节点和连线 | ⬜ 通过 / ❌ 失败 | |
| 场景2: 节点拖拽测试 | ⬜ 通过 / ❌ 失败 | |
| 场景3: 不同距离的连接 | ⬜ 通过 / ❌ 失败 | |
| 场景4: 同向端口连接 | ⬜ 通过 / ❌ 失败 | |
| 场景5: 复杂多节点场景 | ⬜ 通过 / ❌ 失败 | |
| 场景6: 连线删除测试 | ⬜ 通过 / ❌ 失败 | |
| 场景7: 箭头显示测试 | ⬜ 通过 / ❌ 失败 | |

---

## 常见问题排查

### 问题 1: 连线仍然是贝塞尔曲线
**原因：** 可能是缓存未更新
**解决方案：**
- 重启应用程序
- 删除旧的连接，重新创建

### 问题 2: 箭头角度错误
**原因：** 端口方向映射问题
**解决方案：**
- 检查 WorkflowConnection.SourcePort 和 TargetPort 的值
- 确保端口名称是 "Top"/"Bottom"/"Left"/"Right"

### 问题 3: 路径计算错误
**原因：** 端口位置计算问题
**解决方案：**
- 检查 WorkflowNode 的 Position 属性
- 确认 StyleConfig 配置正确

---

## 性能观察

在测试过程中，请观察以下性能指标：

| 指标 | 良好 | 需要优化 |
|-----|------|---------|
| 连线创建速度 | < 100ms | > 500ms |
| 节点拖拽流畅度 | 流畅（> 30fps） | 卡顿（< 15fps） |
| 连线更新延迟 | 无明显延迟 | 明显延迟 |
| 10个节点场景 | 流畅 | 卡顿 |

---

## 测试完成后

如果测试通过：
✅ Phase 1 功能正常，可以继续 Phase 2

如果发现问题：
📝 请记录详细的问题描述和重现步骤
📝 拍摄截图或录屏
📝 报告问题以进行修复

---

## 技术细节参考

### 修改的文件
1. `SunEyeVision.UI/Services/PathCalculators/IPathCalculator.cs`
2. `SunEyeVision.UI/Services/PathCalculators/OrthogonalPathCalculator.cs`
3. `SunEyeVision.UI/Services/ConnectionPathCache.cs`

### 核心特性
- ✅ 正交折线路径（不是贝塞尔曲线）
- ✅ 四种智能路径策略
- ✅ 自动箭头定位和旋转
- ✅ 支持四个端口方向（Top/Bottom/Left/Right）

---

**测试人员：** [您的名字]
**测试日期：** 2026-01-29
**构建版本：** Release
**Phase 状态：** Phase 1 - 路径算法重构
