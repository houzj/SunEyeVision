<Window x:Class="SunEyeVision.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SunEyeVision.UI"
        xmlns:vm="clr-namespace:SunEyeVision.UI.ViewModels"
        xmlns:converters="clr-namespace:SunEyeVision.UI.Converters"
        xmlns:controls="clr-namespace:SunEyeVision.UI.Controls"
        mc:Ignorable="d"
        Title="å¤ªé˜³çœ¼è§†è§‰ - æœºå™¨è§†è§‰å¹³å°" Height="900" Width="1600"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Background="#FFFFFF"
        Loaded="MainWindow_Loaded">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/AppResources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        </ResourceDictionary>
    </Window.Resources>

    <DockPanel>
        <!-- ========== é¡¶éƒ¨èœå•æ  (28px) ========== -->
        <Menu DockPanel.Dock="Top" Height="28" Background="{StaticResource HeaderBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <MenuItem Header="æ–‡ä»¶(_F)">
                <MenuItem Header="æ–°å»ºæ–¹æ¡ˆ(_N)" Command="{Binding NewWorkflowCommand}" InputGestureText="Ctrl+N"/>
                <MenuItem Header="æ‰“å¼€æ–¹æ¡ˆ(_O)" Command="{Binding OpenWorkflowCommand}" InputGestureText="Ctrl+O"/>
                <MenuItem Header="ä¿å­˜æ–¹æ¡ˆ(_S)" Command="{Binding SaveWorkflowCommand}" InputGestureText="Ctrl+S"/>
                <MenuItem Header="å¦å­˜ä¸º(_A)" Command="{Binding SaveAsWorkflowCommand}" InputGestureText="Ctrl+Shift+S"/>
                <Separator/>
                <MenuItem Header="å¯¼å…¥(_I)" InputGestureText="Ctrl+I"/>
                <MenuItem Header="å¯¼å‡º(_E)" InputGestureText="Ctrl+E"/>
                <Separator/>
                <MenuItem Header="æœ€è¿‘æ–‡ä»¶"/>
                <Separator/>
                <MenuItem Header="é€€å‡º(_X)" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="ç¼–è¾‘(_E)">
                <MenuItem Header="æ’¤é”€(_U)" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="é‡åš(_R)" InputGestureText="Ctrl+Y"/>
                <Separator/>
                <MenuItem Header="å¤åˆ¶(_C)" InputGestureText="Ctrl+C"/>
                <MenuItem Header="ç²˜è´´(_V)" InputGestureText="Ctrl+V"/>
                <MenuItem Header="åˆ é™¤(_D)" InputGestureText="Del"/>
                <Separator/>
                <MenuItem Header="å…¨é€‰(_A)" InputGestureText="Ctrl+A"/>
                <MenuItem Header="æŸ¥æ‰¾(_F)" InputGestureText="Ctrl+F"/>
                <MenuItem Header="æ›¿æ¢(_H)" InputGestureText="Ctrl+H"/>
            </MenuItem>
            <MenuItem Header="è§†å›¾(_V)">
                <MenuItem Header="æ–¹æ¡ˆæ ‘(_S)"/>
                <MenuItem Header="å·¥å…·ç®±(_T)"/>
                <MenuItem Header="è®¾å¤‡ç®¡ç†(_D)"/>
                <MenuItem Header="å±žæ€§é¢æ¿(_P)"/>
                <MenuItem Header="æ—¥å¿—çª—å£(_L)"/>
                <MenuItem Header="ç»“æžœé¢„è§ˆ(_R)"/>
                <MenuItem Header="ç³»ç»Ÿä¿¡æ¯(_I)"/>
                <Separator/>
                <MenuItem Header="å…¨å±(_F)" InputGestureText="F11"/>
                <MenuItem Header="é‡ç½®å¸ƒå±€(_R)"/>
            </MenuItem>
            <MenuItem Header="è¿è¡Œ(_R)">
                <MenuItem Header="è¿è¡Œ(_R)" Command="{Binding RunWorkflowCommand}" InputGestureText="F5"/>
                <MenuItem Header="åœæ­¢(_S)" Command="{Binding StopWorkflowCommand}" InputGestureText="Shift+F5"/>
                <MenuItem Header="æš‚åœ(_P)" InputGestureText="Ctrl+Break"/>
                <Separator/>
                <MenuItem Header="è°ƒè¯•æ¨¡å¼(_D)" InputGestureText="Ctrl+Shift+D"/>
                <MenuItem Header="å•æ­¥æ‰§è¡Œ(_S)" InputGestureText="F10"/>
                <MenuItem Header="æ–­ç‚¹(_B)" InputGestureText="F9"/>
            </MenuItem>
            <MenuItem Header="å·¥å…·(_T)">
                <MenuItem Header="ç›¸æœºé…ç½®(_C)"/>
                <MenuItem Header="å‚æ•°ç®¡ç†(_P)"/>
                <MenuItem Header="æ’ä»¶ç®¡ç†(_L)"/>
                <MenuItem Header="ç³»ç»Ÿè®¾ç½®(_S)"/>
                <MenuItem Header="å¿«æ·é”®è®¾ç½®(_K)"/>
            </MenuItem>
            <MenuItem Header="æ’ä»¶(_P)">
                <MenuItem Header="æ’ä»¶å¸‚åœº(_M)"/>
                <MenuItem Header="å®‰è£…æ’ä»¶(_I)"/>
                <MenuItem Header="å¯ç”¨/ç¦ç”¨(_D)"/>
                <MenuItem Header="æ’ä»¶æ›´æ–°(_U)"/>
            </MenuItem>
            <MenuItem Header="å¸®åŠ©(_H)">
                <MenuItem Header="ç”¨æˆ·æ‰‹å†Œ(_M)" InputGestureText="F1" Command="{Binding ShowHelpCommand}"/>
                <MenuItem Header="APIæ–‡æ¡£(_D)"/>
                <MenuItem Header="å¿«æ·é”®(_K)" Command="{Binding ShowShortcutsCommand}"/>
                <MenuItem Header="å…³äºŽ(_A)" Command="{Binding ShowAboutCommand}"/>
            </MenuItem>
        </Menu>

        <!-- ========== å·¥å…·æ  (40px) ========== -->
        <ToolBar DockPanel.Dock="Top" Height="40" Background="{StaticResource HeaderBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <!-- æ–‡ä»¶æ“ä½œç»„ -->
            <Button ToolTip="æ–°å»º (Ctrl+N)" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}" Command="{Binding NewWorkflowCommand}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ“„" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="æ–°å»º" Margin="5,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button ToolTip="æ‰“å¼€ (Ctrl+O)" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}" Command="{Binding OpenWorkflowCommand}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ“‚" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="æ‰“å¼€" Margin="5,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button ToolTip="ä¿å­˜ (Ctrl+S)" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}" Command="{Binding SaveWorkflowCommand}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ’¾" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="ä¿å­˜" Margin="5,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <Separator/>

            <!-- æ‰§è¡ŒæŽ§åˆ¶ç»„ -->
            <Button ToolTip="è¿è¡Œ (F5)" Padding="8,4" Margin="2" Style="{StaticResource PrimaryButton}" Command="{Binding RunWorkflowCommand}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="â–¶ï¸" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="è¿è¡Œ" Margin="5,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button ToolTip="åœæ­¢ (Shift+F5)" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}" Command="{Binding StopWorkflowCommand}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="â¹ï¸" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="åœæ­¢" Margin="5,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <Separator/>

            <!-- å·¥ä½œæµç®¡ç†ç»„ -->
            <Button ToolTip="æ·»åŠ å·¥ä½œæµ" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}" Click="AddWorkflow_Click">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="âž•" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="æ·»åŠ å·¥ä½œæµ" Margin="5,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button ToolTip="æš‚åœ" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="â¸ï¸" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="æš‚åœ" Margin="5,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <Separator/>

            <!-- è°ƒè¯•å·¥å…·ç»„ -->
            <Button ToolTip="å•æ­¥æ‰§è¡Œ (F10)" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="ðŸ”" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="è°ƒè¯•" Margin="5,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <Separator/>

            <!-- ç¼–è¾‘æ“ä½œç»„ -->
            <Button ToolTip="æ’¤é”€ (Ctrl+Z)" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}">
                <TextBlock Text="â†©ï¸" FontSize="16" VerticalAlignment="Center"/>
            </Button>
            <Button ToolTip="é‡åš (Ctrl+Y)" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}">
                <TextBlock Text="â†ªï¸" FontSize="16" VerticalAlignment="Center"/>
            </Button>

            <Separator/>

            <!-- è§†å›¾æŽ§åˆ¶ç»„ -->
            <Button ToolTip="æ”¾å¤§" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}">
                <TextBlock Text="ðŸ”Ž+" FontSize="14" VerticalAlignment="Center"/>
            </Button>
            <Button ToolTip="ç¼©å°" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}">
                <TextBlock Text="ðŸ”Ž-" FontSize="14" VerticalAlignment="Center"/>
            </Button>
            <Button ToolTip="é€‚åº”çª—å£" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}">
                <TextBlock Text="ðŸ“" FontSize="16" VerticalAlignment="Center"/>
            </Button>
            <Button ToolTip="100%" Padding="8,4" Margin="2" Style="{StaticResource SecondaryButton}">
                <TextBlock Text="1:1" FontSize="14" VerticalAlignment="Center" FontWeight="Bold"/>
            </Button>

            <Separator/>

            <TextBlock Text="ç¼©æ”¾: 100%" VerticalAlignment="Center" Margin="8,0,4,0" FontSize="12" Foreground="#666666"/>
        </ToolBar>


        <!-- ========== ä¸»å†…å®¹åŒºåŸŸ ========== -->
        <Grid x:Name="MainContentGrid">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260" x:Name="ToolboxColumn" MinWidth="40" MaxWidth="600"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*" x:Name="WorkflowColumn" MinWidth="400"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="500" x:Name="RightPanelColumn" MinWidth="40" MaxWidth="800"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="24"/>
            </Grid.RowDefinitions>

            <!-- ========== å·¦ä¾§å·¥å…·åŒº - ä½¿ç”¨ToolboxControl ========== -->
            <Border Grid.Column="0" Background="#F8F8F8" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- å·¥å…·ç®±æ ‡é¢˜ -->
                    <Border Grid.Row="0" Background="#FFFFFF" BorderBrush="#CCCCCC" BorderThickness="0,0,0,1" Padding="8,4">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“¦" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="å·¥å…·ç®±" FontWeight="Bold" FontSize="12" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- å·¥å…·ç®±å†…å®¹ -->
                    <controls:ToolboxControl Grid.Row="1" DataContext="{Binding Toolbox}" x:Name="ToolboxContent"/>
                </Grid>
            </Border>

            <!-- å·¦ä¾§åˆ†å‰²å™¨ - å·¥å…·ç®±å’Œå·¥ä½œåŒºä¹‹é—´ -->
            <controls:SplitterWithToggle Grid.Column="1" Width="8" MinWidth="8"
                                         ResizeDirection="Columns"
                                         ToggleDirection="Left"
                                         x:Name="ToolboxSplitter"
                                         ToggleClicked="ToolboxSplitter_ToggleClick"/>

            <!-- ========== ä¸­é—´å·¥ä½œåŒº - TabControlå¤šæµç¨‹ç¼–è¾‘ ========== -->
            <Border Grid.Column="2" Background="#F5F5F5" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0">
                <TabControl x:Name="WorkflowTabControl"
                            Background="#F5F5F5"
                            BorderThickness="0"
                            ItemsSource="{Binding WorkflowTabViewModel.Tabs}"
                            SelectedItem="{Binding WorkflowTabViewModel.SelectedTab, Mode=TwoWay}">
                    <TabControl.Resources>
                        <converters:WorkflowStateToColorConverter x:Key="WorkflowStateToColorConverter"/>
                        <converters:WorkflowStateToTextConverter x:Key="WorkflowStateToTextConverter"/>
                        <converters:ContinuousRunButtonTextConverter x:Key="ContinuousRunButtonTextConverter"/>
                        <converters:ContinuousRunBackgroundConverter x:Key="ContinuousRunBackgroundConverter"/>
                        <converters:ContinuousRunBorderConverter x:Key="ContinuousRunBorderConverter"/>
                    </TabControl.Resources>

                    <!-- è‡ªå®šä¹‰TabItemæ ·å¼ -->
                    <TabControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="Transparent">
                                <StackPanel Orientation="Horizontal" Margin="4,2">
                                    <!-- å·¥ä½œæµåç§° -->
                                    <TextBlock Text="{Binding Name}" FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center"/>

                                    <!-- å•æ¬¡è¿è¡ŒæŒ‰é’® -->
                                    <Button Content="â–¶"
                                            Padding="4,2" Margin="6,0,4,0"
                                            Background="#F0F8FF" BorderBrush="#0066CC" BorderThickness="1"
                                            FontSize="11"
                                            Tag="{Binding}"
                                            Click="TabItem_SingleRun_Click"
                                            Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                                    CornerRadius="3"
                                                                    Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter Content="{TemplateBinding Content}"
                                                                                  HorizontalAlignment="Center"
                                                                                  VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#E6F2FF"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- è¿žç»­è¿è¡Œ/åœæ­¢æŒ‰é’® -->
                                    <Button Content="{Binding IsRunning, Converter={StaticResource ContinuousRunButtonTextConverter}}"
                                            Padding="4,2" Margin="0,0,4,0"
                                            Background="{Binding IsRunning, Converter={StaticResource ContinuousRunBackgroundConverter}}"
                                            BorderBrush="{Binding IsRunning, Converter={StaticResource ContinuousRunBorderConverter}}"
                                            BorderThickness="1"
                                            FontSize="11"
                                            Tag="{Binding}"
                                            Click="TabItem_ContinuousRun_Click"
                                            Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                                    CornerRadius="3"
                                                                    Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter Content="{TemplateBinding Content}"
                                                                                  HorizontalAlignment="Center"
                                                                                  VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#E6F2FF"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- åˆ é™¤æŒ‰é’® -->
                                    <Button Content="Ã—"
                                            Padding="2,0" Margin="0,0,6,0"
                                            Background="Transparent" BorderThickness="0"
                                            FontSize="14"
                                            Foreground="#999999"
                                            Tag="{Binding}"
                                            Click="TabItem_Delete_Click"
                                            Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="#FF4444"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                                    <TextBlock Text="{Binding State, Converter={StaticResource WorkflowStateToTextConverter}}"
                                                FontSize="10"
                                                Foreground="{Binding State, Converter={StaticResource WorkflowStateToColorConverter}}"
                                                VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </TabControl.ItemTemplate>

                    <!-- TabItemå†…å®¹ - æ¯ä¸ªTabåŒ…å«ä¸€ä¸ªWorkflowCanvasControl -->
                    <TabControl.ContentTemplate>
                        <DataTemplate>
                            <Canvas x:Name="WorkflowCanvas"
                                    AllowDrop="True"
                                    DragEnter="WorkflowCanvas_DragEnter"
                                    DragOver="WorkflowCanvas_DragOver"
                                    DragLeave="WorkflowCanvas_DragLeave"
                                    Drop="WorkflowCanvas_Drop">
                                <!-- ç½‘æ ¼èƒŒæ™¯ -->
                                <Canvas.Background>
                                    <DrawingBrush ViewportUnits="Absolute" Viewport="0,0,20,20" TileMode="Tile">
                                        <DrawingBrush.Drawing>
                                            <GeometryDrawing Brush="Transparent">
                                                <GeometryDrawing.Pen>
                                                    <Pen Brush="#E0E0E0" Thickness="0.5"/>
                                                </GeometryDrawing.Pen>
                                                <GeometryDrawing.Geometry>
                                                    <GeometryGroup>
                                                        <LineGeometry StartPoint="0,20" EndPoint="20,20"/>
                                                        <LineGeometry StartPoint="20,0" EndPoint="20,20"/>
                                                    </GeometryGroup>
                                                </GeometryDrawing.Geometry>
                                            </GeometryDrawing>
                                        </DrawingBrush.Drawing>
                                    </DrawingBrush>
                                </Canvas.Background>

                                <!-- å·¥ä½œæµè¿žæŽ¥çº¿ -->
                                <ItemsControl ItemsSource="{Binding WorkflowConnections}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <Canvas/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Line Stroke="#666666" StrokeThickness="2" StrokeDashArray="5,5"
                                                  X1="{Binding SourcePosition.X}" Y1="{Binding SourcePosition.Y}"
                                                  X2="{Binding TargetPosition.X}" Y2="{Binding TargetPosition.Y}"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- å·¥ä½œæµèŠ‚ç‚¹ -->
                                <ItemsControl ItemsSource="{Binding WorkflowNodes}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <Canvas/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemContainerStyle>
                                        <Style>
                                            <Setter Property="Canvas.Left" Value="{Binding Position.X, Mode=TwoWay}"/>
                                            <Setter Property="Canvas.Top" Value="{Binding Position.Y, Mode=TwoWay}"/>
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="140" Height="90" BorderBrush="{StaticResource BorderBrush}" BorderThickness="2"
                                                    Background="#FFFFFF" CornerRadius="4"
                                                    PreviewMouseLeftButtonDown="Node_PreviewMouseLeftButtonDown"
                                                    MouseLeftButtonUp="Node_MouseLeftButtonUp"
                                                    MouseMove="Node_MouseMove"
                                                    Tag="{Binding}">
                                                <Grid MouseLeftButtonUp="Node_ClickForConnection"
                                                      Background="Transparent">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" Padding="6" CornerRadius="3,3,0,0">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="ðŸ”§" FontSize="14"/>
                                                            <TextBlock Text="{Binding Name}" Margin="6,0,0,0" FontWeight="Bold" FontSize="12" Foreground="White"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <TextBlock Grid.Row="1" Text="{Binding AlgorithmType}" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="10" Foreground="#0066CC"/>
                                                    <Border Grid.Row="2" Background="#F0F8FF" Padding="4" CornerRadius="0,0,3,3">
                                                        <TextBlock Text="â±ï¸ 0ms" HorizontalAlignment="Center" FontSize="10" Foreground="#666666"/>
                                                    </Border>
                                                </Grid>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Effect" Value="{x:Null}"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrush}"/>
                                                                <Setter Property="BorderThickness" Value="3"/>
                                                                <Setter Property="Effect">
                                                                    <Setter.Value>
                                                                        <DropShadowEffect Color="#0066CC" BlurRadius="10" ShadowDepth="0"/>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Canvas>
                        </DataTemplate>
                    </TabControl.ContentTemplate>
                </TabControl>
            </Border>

            <!-- å³ä¾§åˆ†å‰²å™¨ - å·¥ä½œåŒºå’Œå³ä¾§é¢æ¿ä¹‹é—´ -->
            <controls:SplitterWithToggle Grid.Column="3" Width="8" MinWidth="8"
                                         ResizeDirection="Columns"
                                         ToggleDirection="Right"
                                         x:Name="RightPanelSplitter"
                                         ToggleClicked="RightPanelSplitter_ToggleClick"/>

            <!-- ========== å³ä¾§é¢æ¿ ========== -->
            <Border Grid.Column="4" Grid.Row="0" Background="#FFFFFF" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0">
                <Grid x:Name="RightPanelGrid">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="500" MinHeight="40" MaxHeight="1000"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*" MinHeight="40" MaxHeight="1000"/>
                    </Grid.RowDefinitions>

                    <!-- å›¾åƒæ˜¾ç¤ºåŒºåŸŸ - ä½¿ç”¨ImageDisplayControl -->
                    <Border Grid.Row="0" Background="#333333" BorderBrush="#333333" BorderThickness="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- å›¾åƒåŒºåŸŸæ ‡é¢˜ -->
                            <Border Grid.Row="0" Background="#444444" BorderBrush="#555555" BorderThickness="0,0,0,0" Padding="8,4">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ–¼ï¸" FontSize="12" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                    <TextBlock Text="å›¾åƒæ˜¾ç¤º" FontWeight="Bold" FontSize="12" VerticalAlignment="Center" Foreground="White"/>
                                </StackPanel>
                            </Border>

                            <!-- å›¾åƒå†…å®¹ -->
                            <controls:ImageDisplayControl Grid.Row="1"
                                ImageSource="{Binding DisplayImage}"
                                Scale="{Binding ImageScale}"
                                x:Name="ImageDisplayContent"/>
                        </Grid>
                    </Border>

                    <!-- å³ä¾§é¢æ¿å†…éƒ¨åˆ†å‰²å™¨ - å›¾åƒæ˜¾ç¤ºå’Œå±žæ€§é¢æ¿ä¹‹é—´ -->
                    <GridSplitter Grid.Row="1" Height="8" Width="Auto" MinHeight="8"
                                 ResizeDirection="Rows"
                                 Background="#DDDDDD"
                                 ShowsPreview="False"
                                 ResizeBehavior="PreviousAndNext"
                                 HorizontalAlignment="Stretch"/>

                    <!-- å±žæ€§é¢æ¿ - ä½¿ç”¨PropertyPanelControl -->
                    <Border Grid.Row="2" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <!-- å±žæ€§å†…å®¹ -->
                            <controls:PropertyPanelControl
                                PropertyGroups="{Binding PropertyGroups}"
                                LogText="{Binding LogText}"
                                x:Name="PropertyPanelContent"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- ========== çŠ¶æ€æ  (24px) ========== -->
            <StatusBar Grid.ColumnSpan="5" Grid.Row="1" Height="24" Background="{StaticResource HeaderBrush}" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
                <StatusBarItem>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="â—" Foreground="#00CC99" FontSize="10" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding StatusText}" FontSize="11" VerticalAlignment="Center"/>
                    </StackPanel>
                </StatusBarItem>
                <Separator/>
                <StatusBarItem>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“· ç›¸æœº:" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding CameraStatus}" FontSize="11" Foreground="#00CC99" VerticalAlignment="Center"/>
                    </StackPanel>
                </StatusBarItem>
                <Separator/>
                <StatusBarItem>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="æµç¨‹1:" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBlock Text="{Binding IsRunning}" FontSize="11" Foreground="#0066CC" VerticalAlignment="Center"/>
                    </StackPanel>
                </StatusBarItem>
                <Separator/>
                <StatusBarItem>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="CPU:" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBlock Text="45%" FontSize="11" VerticalAlignment="Center"/>
                    </StackPanel>
                </StatusBarItem>
                <Separator/>
                <StatusBarItem HorizontalAlignment="Right">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="FPS:" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBlock Text="62.5" FontSize="11" FontWeight="Bold" Foreground="#00CC99" VerticalAlignment="Center"/>
                    </StackPanel>
                </StatusBarItem>
            </StatusBar>
        </Grid>
    </DockPanel>
</Window>
